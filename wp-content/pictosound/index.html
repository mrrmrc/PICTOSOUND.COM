<div class="container">
    <div class="options-section">
        <h3>1. Scegli la tua Immagine</h3>
        <div class="input-actions-container">
            <input type="file" id="imageUpload" accept="image/*" title="Carica un file immagine">
            <button id="takePictureButton" class="icon-button" title="Usa la fotocamera">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="24" height="24">
                    <path
                        d="M4 4h3l2-2h6l2 2h3v16H4V4zm8 13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm0-8c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3z" />
                </svg>
                Scatta Foto
            </button>
        </div>
        <div id="cameraViewContainer">
            <video id="cameraFeed" autoplay playsinline></video>
            <div class="camera-controls">
                <button id="captureImageButton">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                        <path
                            d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0-6c1.1 0 2 .9 2 2s-.9 2-2 2-2-.9-2-2 .9-2 2-2z" />
                        <path d="M4 4h3l2-2h6l2 2h3v16H4V4zm8 13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5z"
                            opacity=".3" />
                        <path
                            d="M20 2H4c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 18H4V4h3l2-2h6l2 2h3v16z" />
                    </svg>
                    Scatta!
                </button>
                <button id="switchCameraButton" title="Cambia Fotocamera">
                    <svg xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 0 24 24" width="20px"
                        fill="currentColor">
                        <path d="M0 0h24v24H0V0z" fill="none" />
                        <path
                            d="M20 5h-3.17L15 3H9L7.17 5H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm-5 11.5V13H9v2.5L5.5 12 9 8.5V11h6V8.5l3.5 3.5-3.5 3.5z" />
                    </svg>
                    Cambia
                </button>
                <button id="closeCameraButton">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                        <path
                            d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" />
                    </svg>
                    Annulla
                </button>
            </div>
        </div>
        <div id="imagePreviewContainer">
            <img id="imagePreview" src="#" alt="Anteprima Immagine" style="display:none;">
            <canvas id="detectionCanvas" style="display:none;"></canvas>
        </div>
    </div>

    <div id="mainContentArea">
        <div class="options-section" id="durationSection">
            <h3>2. Durata Musica</h3>
            <div class="radio-duration-group">
                <div class="radio-duration-item">
                    <input type="radio" id="duration40" name="musicDuration" value="40" checked>
                    <label for="duration40">
                        <span class="duration-value">40s</span>
                        <span class="duration-credit">FREE</span>
                    </label>
                </div>
                <div class="radio-duration-item">
                    <input type="radio" id="duration60" name="musicDuration" value="60">
                    <label for="duration60">
                        <span class="duration-value">60s</span>
                        <span class="duration-credit">1 cr.</span>
                    </label>
                </div>
                <div class="radio-duration-item">
                    <input type="radio" id="duration120" name="musicDuration" value="120">
                    <label for="duration120">
                        <span class="duration-value">120s</span>
                        <span class="duration-credit">2 cr.</span>
                    </label>
                </div>
                <div class="radio-duration-item">
                    <input type="radio" id="duration180" name="musicDuration" value="180">
                    <label for="duration180">
                        <span class="duration-value">180s</span>
                        <span class="duration-credit">3 cr.</span>
                    </label>
                </div>
                <div class="radio-duration-item">
                    <input type="radio" id="duration240" name="musicDuration" value="240">
                    <label for="duration240">
                        <span class="duration-value">240s</span>
                        <span class="duration-credit">4 cr.</span>
                    </label>
                </div>
                <div class="radio-duration-item">
                    <input type="radio" id="duration360" name="musicDuration" value="360">
                    <label for="duration360">
                        <span class="duration-value">360s</span>
                        <span class="duration-credit">5 cr.</span>
                    </label>
                </div>
            </div>
        </div>

        <div class="action-buttons-container">
            <button id="generateMusicButton" disabled>Avvia generazione musica <span id="musicSpinner"
                    style="display:none;" class="spinner"></span></button>
        </div>

        <div id="dynamicFeedbackArea">
            <div id="status" class="status-message" style="margin-bottom: 15px;">In attesa del caricamento dei modelli
                AI...</div>
            <div id="progressAndPlayerContainer">
                <div id="progressMessage"></div>
                <div class="progress-bar-container" id="progressBarContainer">
                    <div class="progress-bar-animated" id="progressBarAnimated"></div>
                </div>
                <div id="audioPlayerContainer">
                    <h3>Musica Generata</h3>
                    <audio id="audioPlayer" controls src=""></audio>
                    <p id="audioInfo"></p>
                    <div id="downloadButtonsContainer">
                        <a id="downloadAudioLink" href="#" class="download-button" style="display:none;">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="18"
                                height="18">
                                <path
                                    d="M19.35 10.04A7.49 7.49 0 0 0 12 4C9.11 4 6.6 5.64 5.35 8.04A5.994 5.994 0 0 0 0 14a6 6 0 0 0 6 6h13a5 5 0 0 0 5-5c0-2.64-2.05-4.78-4.65-4.96zM17 13l-5 5-5-5h3V9h4v4h3z" />
                            </svg>
                            Scarica Audio
                        </a>
                        <a id="downloadCompositeImageLink" href="#" class="download-button" style="display:none;">
                            <span class="button-icon-placeholder">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"
                                    width="18" height="18">
                                    <path d="M5 20h14v-2H5v2zm14-9h-4V3H9v8H5l7 7 7-7z" />
                                </svg>
                            </span>
                            Scarica Img+QR
                        </a>
                        <a id="downloadQrOnlyLink" href="#" class="download-button" style="display:none;">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="18"
                                height="18">
                                <path
                                    d="M3 11h8V3H3v8zm2-6h4v4H5V5zm8-2v8h8V3h-8zm6 6h-4V5h4v4zM3 21h8v-8H3v8zm2-6h4v4H5v-4zm13-2h-2v3h-3v2h5v-5zM13 3h2v2h-2V3zm0 16h2v2h-2v-2zm-5-5h2v2H8v-2z" />
                            </svg>
                            Scarica QR
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <div id="aiInsightsSection" class="options-section">
            <h3>COSA VEDE L'AI</h3>
            <p id="aiInterpretationText">L'intelligenza artificiale ha analizzato la tua immagine per coglierne
                l'essenza e trasformarla in musica. Ecco come ha interpretato gli elementi visivi:</p>
            <div class="details-accordion-header">
                <span>Dettagli</span>
                <span class="toggle-icon"></span>
            </div>
            <div id="aiInsightsContent">
                <div class="ai-processing-simulation" id="aiProcessingSimulation">
                    <p>In attesa di analisi immagine...</p>
                </div>
            </div>
        </div>

        <!-- SEZIONE PERSONALIZZAZIONI MOBILE-FRIENDLY -->
        <div class="options-section" id="descriptiveCuesSection">
            <h3>FAI LE TUE PERSONALIZZAZIONI <span
                    style="font-weight:normal; font-size:0.8em; color:var(--light-text);">(opzionale)</span></h3>
            <p class="info-text-cues-main">L'IA genererà la musica anche senza selezioni, basandosi sull'immagine. Le
                tue scelte aiuteranno a guidare l'interpretazione.</p>

            <!-- BPM SLIDER SEPARATO -->
            <div class="bpm-slider-container"
                style="margin: 20px 0; padding: 20px; background: #f8f9fa; border-radius: 8px;">
                <label for="bpmSlider" style="font-weight: 600; margin-bottom: 10px; display: block;">🎵 Tempo (BPM):
                    <span id="bpmValue">120</span></label>
                <input type="range" id="bpmSlider" name="bpm" min="40" max="200" value="120" step="5"
                    style="width: 100%;">
            </div>

            <!-- VERSIONE MOBILE-FRIENDLY -->
            <div class="cues-mobile-container">

                <!-- MOOD -->
                <div class="cues-mobile-section">
                    <div class="cues-selection-container">
                        <label class="group-label collapsible-cue-header" for="moodPills">
                            <div class="cue-header-content">
                                <span style="font-size: 1.5em;">😊</span>
                                <span class="cue-title">Mood</span>
                            </div>
                            <span class="toggle-icon-cues"></span>
                        </label>
                        <div class="checkbox-pills-group" id="moodPills"></div>
                    </div>
                </div>

                <!-- GENERE -->
                <div class="cues-mobile-section">
                    <div class="cues-selection-container">
                        <label class="group-label collapsible-cue-header" for="genrePills">
                            <div class="cue-header-content">
                                <span style="font-size: 1.5em;">🎵</span>
                                <span class="cue-title">Genere</span>
                            </div>
                            <span class="toggle-icon-cues"></span>
                        </label>
                        <div class="checkbox-pills-group" id="genrePills"></div>
                    </div>
                </div>

                <!-- STRUMENTI -->
                <div class="cues-mobile-section">
                    <div class="cues-selection-container">
                        <label class="group-label collapsible-cue-header" for="instrumentPills">
                            <div class="cue-header-content">
                                <span style="font-size: 1.5em;">🎹</span>
                                <span class="cue-title">Strumenti</span>
                            </div>
                            <span class="toggle-icon-cues"></span>
                        </label>
                        <div class="checkbox-pills-group" id="instrumentPills"></div>
                    </div>
                </div>

                <!-- RITMO -->
                <div class="cues-mobile-section">
                    <div class="cues-selection-container">
                        <label class="group-label collapsible-cue-header" for="rhythmPills">
                            <div class="cue-header-content">
                                <span style="font-size: 1.5em;">🥁</span>
                                <span class="cue-title">Ritmo</span>
                            </div>
                            <span class="toggle-icon-cues"></span>
                        </label>
                        <div class="checkbox-pills-group" id="rhythmPills"></div>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>

<!-- Canvas e elementi nascosti -->
<canvas id="imageCanvas" style="display:none;"></canvas>
<canvas id="compositeImageCanvas" style="display:none;"></canvas>
<textarea id="additionalCuesTextarea" style="display:none;"></textarea>

<!-- Caricamento delle librerie e stili necessari -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="/wp-content/pictosound/css/style.css">

<!-- CSS AGGIUNTIVO SOLO PER MOBILE-FIX -->
<style>
    /* Mobile fix per le personalizzazioni */
    .cues-mobile-container {
        display: flex;
        flex-direction: column;
        gap: 20px;
    }

    .cues-mobile-section {
        width: 100%;
    }

    /* Emoji al posto delle icone brutte */
    .cue-header-content {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    /* Responsive migliorato */
    @media (min-width: 768px) {
        .cues-mobile-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
        }
    }

    @media (min-width: 1024px) {
        .cues-mobile-container {
            grid-template-columns: repeat(4, 1fr);
        }
    }

    /* Migliore spacing su mobile */
    @media (max-width: 767px) {
        .checkbox-pills-group {
            margin-top: 15px;
        }

        .bpm-slider-container {
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .info-text-cues-main {
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: 20px;
        }
    }
</style>